var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.PdfService=function(e,t,n){var i,a=this;switch(this.pdfDocument=e,this.pdfInfo=e._pdfInfo,this.numPages=this.pdfInfo.numPages,this.webgl="webgl"==n.viewMode&&this.numPages>1,this.options=n,this.main=n.main,this.main=t,this.pages=[],this.thumbs=[],this.canvasBuffer=[],window.cb=this.canvasBuffer,this.viewports=[],this.eventBus=new EventBus,this.linkService=new PDFLinkService({eventBus:this.eventBus}),this.linkService.setViewer(this.main),this.linkService.setDocument(e),n.pdfLinkTarget){case"_self":i=pdfjsLib.LinkTarget.SELF;break;case"_parent":i=pdfjsLib.LinkTarget.PARENT;break;case"_top":i=pdfjsLib.LinkTarget.TOP;break;default:i=pdfjsLib.LinkTarget.BLANK}this.linkService.externalLinkTarget=i,window._dbg=0,this.getCanvas=function(e){var t,n;for(t=0;t<this.canvasBuffer.length;t++){if((n=this.canvasBuffer[t]).available){n.available=!1,n.double=!1;break}n=null}return n||((n=document.createElement("canvas")).available=!1,n.index=this.canvasBuffer.length,this.canvasBuffer.push(n)),n},this.loadThumbs=function(e,t){var n=this;this.thumbLoading=this.thumbLoading||0,this.thumbLoading>=this.pdfInfo.numPages?t.call(n):this.loadThumb(this.thumbLoading,(function(i){n.options.thumbLoaded(i),n.thumbLoading++,n.loadThumbs(e,t)}))},this.loadThumb=function(e,t){var n=this;this.getViewport(e,(function(){var i=n.pages[e],a=100/i.getViewport({scale:1}).height,s=i.getViewport({scale:a}),r=document.createElement("canvas");r.index=e;var o=r.getContext("2d");o.willReadFrequently=!0,r.height=s.height,r.width=s.width;var l={canvasContext:o,viewport:s};i.cleanupAfterRender=!0,i.render(l).then((function(){i.cleanup(),t&&t.call(n,r)}))}))},this.init=function(e){a.getViewport(0,(function(t){a.r1=t.width/t.height,1==a.pdfInfo.numPages?(a.double=!1,a.main.trigger("pdfinit")):a.getViewport(1,(function(t){a.r2=t.width/t.height,a.double=a.r2/a.r1>1.5,a.backCover=e||!0,a.main.trigger("pdfinit")}))}))},this.loadOutline=function(e){var t=this;this.pdfDocument.getOutline().then((function(n){t.outline=n,t.outlineLoaded=!0,e.call(t,n)}))},this.startLoadingText=function(){this.loadingText=!0},this.stopLoadingText=function(){this.loadingText=!1},this.getPdfPage=async function(e){return this.pages[e]||await this.pdfDocument.getPage(e+1)},this.getPageViewport=async function(e){return(await this.getPage(e)).getViewport({scale:1})},this.getViewport=function(t,n){t>=a.pdfInfo.numPages||(a.pages[t]?(a.viewports[t]=a.pages[t].getViewport({scale:1}),n.call(a,a.viewports[t])):e.getPage(t+1).then((function(e){a.pages[e._pageIndex]=e,a.getViewport(e._pageIndex,n)})))},this.getPageViewport=async function(t){return this.pages[t]||(this.pages[t]=await e.getPage(t+1)),this.viewports[t]=this.pages[t].getViewport({scale:1}),this.viewports[t]},this.getText=function(e,t){var n=this;this.getViewport(e,(function(i){var a=n.pages[e];n.getTextContent(a,(function(){t.call(n,a)}))}))},this.getTextAllPages=function(e){var t=this;this.loadingTextFromPage=this.loadingTextFromPage||0,this.getText(this.loadingTextFromPage,(function(){t.loadingTextFromPage==t.numPages-1?e&&e.call(t):(t.loadingTextFromPage++,t.getTextAllPages(e))}))},this.findInPage=function(e,t,n){var i=this;this.findInPageCallbacks=this.findInPageCallbacks||[],this.findInPageCallbacks[t]=n,this.searchingString=e,this.pages[t]&&this.pages[t].textContent?i.findInPageTextContentAvailable(this.pages[t],t):this.getText(t,(function(e){i.findInPageTextContentAvailable(e,t)}))},this.findInPageTextContentAvailable=function(e,t){var n=e.textContent.items;if(void 0===e.textContentString){e.textContentString="";for(var i=0;i<n.length;i++)e.textContentString+=n[i].str}var a=this,s=[],r="";n.forEach((function(e){r+=e.str})),r=r.replace(/\s+/g," ").trim(),a.searchingString=a.searchingString.replace(/\s+/g," ").trim();let o=new RegExp(a.searchingString,"ig"),l=new RegExp(a.searchingString,"i"),c=r.match(o);if(c){c.forEach((function(e){s.push({page:t})}));let e=r.search(l);-1!==e&&(r=r.substring(e))}var h=this.findInPageCallbacks[t];h&&h.call(this,s,e.htmlContent,e._pageIndex,r.substring(0,60)+"..."),this.findInPageCallbacks[t]=null},this.getThumb=function(e,t,n){this.getViewport(e,(function(i){var s=a.pages[e];if(s.thumb)n.call(a,s.thumb);else{var r=t/a.viewports[e].height;i=s.getViewport({scale:r});var o=document.createElement("canvas");s.thumb=o;var l=o.getContext("2d");o.height=i.height,o.width=i.width;var c={canvasContext:l,viewport:i};s.cleanupAfterRender=!0,s.render(c).then((function(){s.cleanup(),n.call(a,s.thumb)}))}}))},this.getPage=function(t,n){var i=this;(i.double?Math.round(t/2)+1:t+1)>this.pdfInfo.numPages||e.getPage(t).then((function(e){i.renderPage(e,n)}))},this.renderPage=async function(e,t){if(e.renderingPromises=e.renderingPromises||{},!e.renderingPromises[t]){var n,i=e.getViewport({scale:1}),s=i.width<=i.height||!a.webgl?t/i.height:t/i.width,r=e.getViewport({scale:s});(n="undefined"!=typeof OffscreenCanvas?new OffscreenCanvas(r.width,r.height):a.getCanvas(t)).size=t,n.pdfPageIndex=e._pageIndex,n.width=r.width,n.height=r.height;var o=n.getContext("2d");o.fillStyle="#000000",o.willReadFrequently=!0;var l={canvasContext:o,viewport:r};e.scale=s,e.canvas=e.canvas||{},e.canvas[t]=n,e.canvas[t].ratio=r.width/r.height,e.cleanupAfterRender=!0,e.renderingPromises[t]=e.render(l).promise}await e.renderingPromises[t],n=null},this.renderBookPage=async function(t,n,i){var a=this.options.doublePage?Math.round(t/2):t,s=this.pages[a]||await e.getPage(a+1);s.renderCallbacks=s.renderCallbacks||{},s.renderCallbacks[n]=s.renderCallbacks[n]||[],s.renderCallbacks[n].push(i),await this.renderPage(s,n),await this.createPageImage(s,n),s.renderCallbacks[n].forEach((e=>{this.onPdfPageImageReady(s,n,e)})),s.renderCallbacks[n]=[]},this.loadPageTextLayer=async function(e){const t=await a.getPdfPage(e);return a.options.pdfTextLayer&&(t.textloadingTask=t.textloadingTask||t.getTextContent(),t.textContent=await t.textloadingTask),a.options.annotationLayer&&(t.annotationloadingTask=t.annotationloadingTask||t.getAnnotations({intent:"display"}),t.annotations=await t.annotationloadingTask),t},this.loadTextLayer=async function(e,t){var i=this.options.doublePage?Math.round(e/2):e,a=this;const s=await this.loadPageTextLayer(i);var r=n.pages[e]||{};if(r.index=e,r.htmlContentInitialized)t.call(this);else{r.htmlContentInitialized=!0,r.textRendering=!0;var o=document.createElement("div");o.classList.add("flipbook-page-htmlContent"),o.dataset.pageNumber=i+1;var l=r.htmlContent[0]||r.htmlContent;if(l&&l.appendChild(o),r.htmlContent=l,s.textContent){var c=document.createElement("div");c.className="flipbook-textLayer",o.appendChild(c),r.textLayerDiv=o;var h=1e3/s.getViewport({scale:1}).height;c.style.width=String(1e3*s.getViewport({scale:1}).width/s.getViewport({scale:1}).height)+"px",c.style.height="1000px";var d=new TextLayerBuilder({eventBus:a.eventBus,textLayerDiv:c,pageIndex:i,viewport:s.getViewport({scale:h})});if(d.setTextContent(s.textContent),d.render(),s.annotations.length>0){var g=document.createElement("div");g.className="annotationLayer",o.appendChild(g);var u={viewport:s.getViewport({scale:1e3/s.getViewport({scale:1}).height}).clone({dontFlip:!0}),div:g,annotations:s.annotations,page:s,linkService:a.linkService};pdfjsLib.AnnotationLayer.render(u)}o.style.transformOrigin="0 0",this.eventBus.on("textlayerrendered",(function(e){e.source.pageIdx==i&&(r.textRendering=!1,r.textLayerRendered=!0,a.main.trigger("textlayerrendered",{index:i}),a.options.pdfAutoLinks&&r.htmlContent.querySelectorAll("span").forEach((function(e){e.innerHTML=a.Linkify(e.innerHTML)})),t.call(this))}))}else t.call(this)}},this.Linkify=function(e){var t=e.replace(/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,'<a href="$1" target="_blank" class="flipbook-page-auto-link">$1</a>');return t=(t=t.replace(/(^|[^\/])(www\.[\S]+(\b|$))/gim,'$1<a href="http://$2" target="_blank" class="flipbook-page-auto-link">$2</a>')).replace(/(([a-zA-Z0-9_\-\.]+)@[a-zA-Z_]+?(?:\.[a-zA-Z]{2,6}))+/gim,'<a href="mailto:$1" class="flipbook-page-auto-link">$1</a>')},this.convertToBlob=async function(e,t="image/webp",n=.8){return new Promise(((i,a)=>{"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?e.convertToBlob({type:t,quality:n}).then(i).catch(a):e.toBlob((e=>{e?i(e):a(new Error("Unable to convert canvas to Blob."))}),t,n)}))},this.onBookPageRendered=function(e,t,n,i){this.main.trigger("pageLoaded",{index:n,size:i,canvas:t,images:e.image[i]})},this.getBookPage=function(e,t){var n=null;return this.canvasBuffer.forEach((function(i){i.pageIndex==e&&i.size==t&&(n=i)})),n},this.onPdfPageImageReady=function(e,t,i){if(e.canvas&&e.canvas[t]&&e.image[t]){var s=e.canvas[t],r=e.image[t],o=e._pageIndex;if(s.pdfPageIndex=o,n.doublePage)if(0==o)s.pageIndex=0,a.onBookPageRendered(e,s,0,t);else if(o==n.pages.length/2)s.pageIndex=n.numPages-1,a.onBookPageRendered(e,s,n.numPages-1,t);else if(a.webgl)s.double=!0,s.scaleX=s.width/2/t,s.pageIndex=2*o,a.onBookPageRendered(e,s,2*o,t),a.onBookPageRendered(e,s,2*o-1,t);else{var l=a.options.rightToLeft?2*o-1:2*o,c=a.options.rightToLeft?2*o:2*o-1;a.onBookPageRendered(e,r,c,t),a.onBookPageRendered(e,r.clone,l,t),s.size=200,s.pageIndex=c}else s.pageIndex=o,s.index=o,s.size=t,a.onBookPageRendered(e,s,o,t);i&&i.call(a,{canvas:s,image:e.image,size:t,pdfPageIndex:o,htmlContent:e.htmlContent}),i=null}},this.loadImage=async function(e){return new Promise(((t,n)=>{e.complete?t(e):(e.onload=()=>{e.onload=null,t(e)},e.onerror=t=>{e.onerror=null,n(t)})}))},this.createPageImage=async function(e,t){e.convertToBlobPromises=e.convertToBlobPromises||{},e.convertToBlobPromises[t]||(e.convertToBlobPromises[t]=this.convertToBlob(e.canvas[t]));const i=await e.convertToBlobPromises[t];if(e.image=e.image||{},e.image[t]||(e.image[t]=new Image),!e.image[t].src){const n=URL.createObjectURL(i);e.image[t].src=n}return await this.loadImage(e.image[t]),n.doublePage&&e._pageIndex>0&&e._pageIndex<n.pages.length/2&&!this.webgl&&(e.image[t].clone||(e.image[t].clone=new Image),e.image[t].clone.src=URL.createObjectURL(i),e.image[t].clone.className="clone",await this.loadImage(e.image[t].clone)),e},this.getTextContent=function(e,t){if(e.getTextCallback=t,e.textContent)e.getTextCallback(e);else{if(e.textContentLoading){var n=this;return void setTimeout((function(){n.getTextContent(e,t)}),100)}e.getTextContent().then((function(t){e.textContent=t,e.textContentLoading=!1,e.textContentLoaded=!0,e.getTextCallback(e)})),e.textContentLoading=!0}}},FLIPBOOK.PdfService.prototype={};var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var EventBus=function(){function e(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).dispatchToDOM,n=void 0!==t&&t;_classCallCheck(this,e),this._listeners=Object.create(null),this._dispatchToDOM=!0===n}return _createClass(e,[{key:"on",value:function(e,t){var n=this._listeners[e];n||(n=[],this._listeners[e]=n),n.push(t)}},{key:"off",value:function(e,t){var n=this._listeners[e],i=void 0;!n||(i=n.indexOf(t))<0||n.splice(i,1)}},{key:"dispatch",value:function(e){var t=this._listeners[e];if(t&&0!==t.length){var n=Array.prototype.slice.call(arguments,1);t.slice(0).forEach((function(e){e.apply(null,n)})),this._dispatchToDOM&&this._dispatchDOMEvent(e,n)}else if(this._dispatchToDOM){var i=Array.prototype.slice.call(arguments,1);this._dispatchDOMEvent(e,i)}}},{key:"_dispatchDOMEvent",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this._dispatchToDOM){var n=Object.create(null);if(t&&t.length>0){var i=t[0];for(var a in i){var s=i[a];if("source"!==a)n[a]=s;else if(s===window||s===document)return}}var r=document.createEvent("CustomEvent");r.initCustomEvent(e,!0,!0,n),document.dispatchEvent(r)}}}]),e}(),EXPAND_DIVS_TIMEOUT=300,MATCH_SCROLL_OFFSET_TOP=-50,MATCH_SCROLL_OFFSET_LEFT=-400,TextLayerBuilder=function(){function e(t){var n=t.textLayerDiv,i=t.eventBus,a=t.pageIndex,s=t.viewport,r=t.findController,o=void 0===r?null:r,l=t.enhanceTextSelection,c=void 0!==l&&l;_classCallCheck(this,e),this.textLayerDiv=n,this.eventBus=i||(0,_dom_events.getGlobalEventBus)(),this.textContent=null,this.textContentItemsStr=[],this.textContentStream=null,this.renderingDone=!1,this.pageIdx=a,this.pageNumber=this.pageIdx+1,this.matches=[],this.viewport=s,this.textDivs=[],this.findController=o,this.textLayerRenderTask=null,this.enhanceTextSelection=c,this._boundEvents=Object.create(null),this._bindEvents(),this._bindMouse()}return _createClass(e,[{key:"_finishRendering",value:function(){if(this.renderingDone=!0,!this.enhanceTextSelection){var e=document.createElement("div");e.className="endOfContent",this.textLayerDiv.appendChild(e)}this.eventBus.dispatch("textlayerrendered",{source:this,pageNumber:this.pageNumber,numTextDivs:this.textDivs.length})}},{key:"render",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if((this.textContent||this.textContentStream)&&!this.renderingDone){this.cancel(),this.textDivs=[];var n=document.createDocumentFragment();this.textLayerRenderTask=(0,pdfjsLib.renderTextLayer)({textContent:this.textContent,textContentStream:this.textContentStream,container:n,viewport:this.viewport,textDivs:this.textDivs,textContentItemsStr:this.textContentItemsStr,timeout:t,enhanceTextSelection:this.enhanceTextSelection}),this.textLayerRenderTask.promise.then((function(){e.textLayerDiv.appendChild(n),e._finishRendering(),e.updateMatches()}),(function(e){}))}}},{key:"cancel",value:function(){this.textLayerRenderTask&&(this.textLayerRenderTask.cancel(),this.textLayerRenderTask=null)}},{key:"setTextContentStream",value:function(e){this.cancel(),this.textContentStream=e}},{key:"setTextContent",value:function(e){this.cancel(),this.textContent=e}},{key:"convertMatches",value:function(e,t){var n=0,i=0,a=this.textContentItemsStr,s=a.length-1,r=null===this.findController?0:this.findController.state.query.length,o=[];if(!e)return o;for(var l=0,c=e.length;l<c;l++){for(var h=e[l];n!==s&&h>=i+a[n].length;)i+=a[n].length,n++;n===a.length&&console.error("Could not find a matching mapping");var d={begin:{divIdx:n,offset:h-i}};for(h+=t?t[l]:r;n!==s&&h>i+a[n].length;)i+=a[n].length,n++;d.end={divIdx:n,offset:h-i},o.push(d)}return o}},{key:"renderMatches",value:function(e){if(0!==e.length){var t=this.textContentItemsStr,n=this.textDivs,i=null,a=this.pageIdx,s=null!==this.findController&&a===this.findController.selected.pageIdx,r=null===this.findController?-1:this.findController.selected.matchIdx,o={divIdx:-1,offset:void 0},l=r,c=l+1;if(null!==this.findController&&this.findController.state.highlightAll)l=0,c=e.length;else if(!s)return;for(var h=l;h<c;h++){var d=e[h],g=d.begin,u=d.end,f=s&&h===r?" selected":"";if(this.findController&&this.findController.selected.matchIdx===h&&this.findController.selected.pageIdx===a){var v={top:MATCH_SCROLL_OFFSET_TOP,left:MATCH_SCROLL_OFFSET_LEFT};(0,_ui_utils.scrollIntoView)(n[g.divIdx],v,!0)}if(i&&g.divIdx===i.divIdx?y(i.divIdx,i.offset,g.offset):(null!==i&&y(i.divIdx,i.offset,o.offset),x(g)),g.divIdx===u.divIdx)y(g.divIdx,g.offset,u.offset,"highlight"+f);else{y(g.divIdx,g.offset,o.offset,"highlight begin"+f);for(var p=g.divIdx+1,m=u.divIdx;p<m;p++)n[p].className="highlight middle"+f;x(u,"highlight end"+f)}i=u}i&&y(i.divIdx,i.offset,o.offset)}function x(e,t){var i=e.divIdx;n[i].textContent="",y(i,0,e.offset,t)}function y(e,i,a,s){var r=n[e],o=t[e].substring(i,a),l=document.createTextNode(o);if(s){var c=document.createElement("span");return c.className=s,c.appendChild(l),void r.appendChild(c)}r.appendChild(l)}}},{key:"updateMatches",value:function(){if(this.renderingDone){for(var e=this.matches,t=this.textDivs,n=this.textContentItemsStr,i=-1,a=0,s=e.length;a<s;a++){for(var r=e[a],o=Math.max(i,r.begin.divIdx),l=r.end.divIdx;o<=l;o++){var c=t[o];c.textContent=n[o],c.className=""}i=r.end.divIdx+1}if(this.findController&&this.findController.highlightMatches){var h=void 0,d=void 0;null!==this.findController&&(h=this.findController.pageMatches[this.pageIdx]||null,d=this.findController.pageMatchesLength&&this.findController.pageMatchesLength[this.pageIdx]||null),this.matches=this.convertMatches(h,d),this.renderMatches(this.matches)}}}},{key:"_bindEvents",value:function(){var e=this,t=this.eventBus,n=this._boundEvents;n.pageCancelled=function(i){if(i.pageNumber===e.pageNumber)if(e.textLayerRenderTask)console.error("TextLayerBuilder._bindEvents: `this.cancel()` should have been called when the page was reset, or rendering cancelled.");else for(var a in n)t.off(a.toLowerCase(),n[a]),delete n[a]},n.updateTextLayerMatches=function(t){t.pageIndex!==e.pageIdx&&-1!==t.pageIndex||e.updateMatches()},t.on("pagecancelled",n.pageCancelled),t.on("updatetextlayermatches",n.updateTextLayerMatches)}},{key:"_bindMouse",value:function(){var e=this,t=this.textLayerDiv,n=null;t.addEventListener("mousedown",(function(i){if(e.enhanceTextSelection&&e.textLayerRenderTask)return e.textLayerRenderTask.expandTextDivs(!0),void(n&&(clearTimeout(n),n=null));var a=t.querySelector(".endOfContent");if(a){var s=i.target!==t;if(s=s&&"none"!==window.getComputedStyle(a).getPropertyValue("-moz-user-select")){var r=t.getBoundingClientRect(),o=Math.max(0,(i.pageY-r.top)/r.height);a.style.top=(100*o).toFixed(2)+"%"}a.classList.add("active")}})),t.addEventListener("mouseup",(function(){if(e.enhanceTextSelection&&e.textLayerRenderTask)n=setTimeout((function(){e.textLayerRenderTask&&e.textLayerRenderTask.expandTextDivs(!1),n=null}),EXPAND_DIVS_TIMEOUT);else{var i=t.querySelector(".endOfContent");i&&(i.style.top="",i.classList.remove("active"))}}))}}]),e}(),DefaultTextLayerFactory=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"createTextLayerBuilder",value:function(e,t,n){return new TextLayerBuilder({textLayerDiv:e,pageIndex:t,viewport:n,enhanceTextSelection:arguments.length>3&&void 0!==arguments[3]&&arguments[3]})}}]),e}(),PDFLinkService=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.eventBus,i=t.externalLinkTarget,a=void 0===i?null:i,s=t.externalLinkRel,r=void 0===s?null:s;_classCallCheck(this,e),this.eventBus=n||(0,_dom_events.getGlobalEventBus)(),this.externalLinkTarget=a,this.externalLinkRel=r,this.baseUrl=null,this.pdfDocument=null,this.pdfViewer=null,this.pdfHistory=null,this._pagesRefCache=null}return _createClass(e,[{key:"setDocument",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.baseUrl=t,this.pdfDocument=e,this._pagesRefCache=Object.create(null)}},{key:"setViewer",value:function(e){this.pdfViewer=e}},{key:"setHistory",value:function(e){this.pdfHistory=e}},{key:"goToDestination",value:function(e){var t=this,n=function n(i){var a=i.namedDest,s=i.explicitDest,r=s[0],o=void 0;if(r instanceof Object||"object"==typeof r){if(null===(o=t._cachedPageNumber(r)))return void t.pdfDocument.getPageIndex(r).then((function(e){t.cachePageRef(e+1,r),n({namedDest:a,explicitDest:s})})).catch((function(){console.error('PDFLinkService.navigateTo: "'+r+'" is not a valid page reference, for dest="'+e+'".')}))}else{if(!Number.isInteger(r))return void console.error('PDFLinkService.navigateTo: "'+r+'" is not a valid destination reference, for dest="'+e+'".');o=r+1}!o||o<1||o>t.pagesCount?console.error('PDFLinkService.navigateTo: "'+o+'" is not a valid page number, for dest="'+e+'".'):(t.pdfHistory&&(t.pdfHistory.pushCurrentPosition(),t.pdfHistory.push({namedDest:a,explicitDest:s,pageNumber:o})),t.pdfViewer.scrollPageIntoView({pageNumber:o,destArray:s}))};new Promise((function(n,i){"string"!=typeof e?n({namedDest:"",explicitDest:e}):t.pdfDocument.getDestination(e).then((function(t){n({namedDest:e,explicitDest:t})}))})).then((function(t){Array.isArray(t.explicitDest)?n(t):console.error('PDFLinkService.navigateTo: "'+t.explicitDest+'" is not a valid destination array, for dest="'+e+'".')}))}},{key:"navigateTo",value:function(e){var t=this,n=function n(i){var a=i.namedDest,s=i.explicitDest,r=s[0],o=void 0;if(r instanceof Object||"object"==typeof r){if(null===(o=t._cachedPageNumber(r)))return void t.pdfDocument.getPageIndex(r).then((function(e){t.cachePageRef(e+1,r),n({namedDest:a,explicitDest:s})})).catch((function(){console.error('PDFLinkService.navigateTo: "'+r+'" is not a valid page reference, for dest="'+e+'".')}))}else{if(!Number.isInteger(r))return void console.error('PDFLinkService.navigateTo: "'+r+'" is not a valid destination reference, for dest="'+e+'".');o=r+1}!o||o<1||o>t.pagesCount?console.error('PDFLinkService.navigateTo: "'+o+'" is not a valid page number, for dest="'+e+'".'):(t.pdfHistory&&(t.pdfHistory.pushCurrentPosition(),t.pdfHistory.push({namedDest:a,explicitDest:s,pageNumber:o})),t.pdfViewer.scrollPageIntoView({pageNumber:o,destArray:s}))};new Promise((function(n,i){"string"!=typeof e?n({namedDest:"",explicitDest:e}):t.pdfDocument.getDestination(e).then((function(t){n({namedDest:e,explicitDest:t})}))})).then((function(t){Array.isArray(t.explicitDest)?n(t):console.error('PDFLinkService.navigateTo: "'+t.explicitDest+'" is not a valid destination array, for dest="'+e+'".')}))}},{key:"getDestinationHash",value:function(e){if("string"==typeof e)return this.getAnchorUrl("#"+escape(e));if(Array.isArray(e)){var t=JSON.stringify(e);return this.getAnchorUrl("#"+escape(t))}return this.getAnchorUrl("")}},{key:"getAnchorUrl",value:function(e){return(this.baseUrl||"")+e}},{key:"setHash",value:function(e){var t=void 0,n=void 0;if(e.includes("=")){var i=(0,_ui_utils.parseQueryString)(e);if("search"in i&&this.eventBus.dispatch("findfromurlhash",{source:this,query:i.search.replace(/"/g,""),phraseSearch:"true"===i.phrase}),"nameddest"in i)return void this.navigateTo(i.nameddest);if("page"in i&&(t=0|i.page||1),"zoom"in i){var a=i.zoom.split(","),s=a[0],r=parseFloat(s);s.includes("Fit")?"Fit"===s||"FitB"===s?n=[null,{name:s}]:"FitH"===s||"FitBH"===s||"FitV"===s||"FitBV"===s?n=[null,{name:s},a.length>1?0|a[1]:null]:"FitR"===s?5!==a.length?console.error('PDFLinkService.setHash: Not enough parameters for "FitR".'):n=[null,{name:s},0|a[1],0|a[2],0|a[3],0|a[4]]:console.error('PDFLinkService.setHash: "'+s+'" is not a valid zoom value.'):n=[null,{name:"XYZ"},a.length>1?0|a[1]:null,a.length>2?0|a[2]:null,r?r/100:s]}n?this.pdfViewer.scrollPageIntoView({pageNumber:t||this.page,destArray:n,allowNegativeOffset:!0}):t&&(this.page=t),"pagemode"in i&&this.eventBus.dispatch("pagemode",{source:this,mode:i.pagemode})}else{n=unescape(e);try{n=JSON.parse(n),Array.isArray(n)||(n=n.toString())}catch(e){}if("string"==typeof n||isValidExplicitDestination(n))return void this.navigateTo(n);console.error('PDFLinkService.setHash: "'+unescape(e)+'" is not a valid destination.')}}},{key:"executeNamedAction",value:function(e){switch(e){case"GoBack":this.pdfHistory&&this.pdfHistory.back();break;case"GoForward":this.pdfHistory&&this.pdfHistory.forward();break;case"NextPage":this.page<this.pagesCount&&this.page++;break;case"PrevPage":this.page>1&&this.page--;break;case"LastPage":this.page=this.pagesCount;break;case"FirstPage":this.page=1}this.eventBus.dispatch("namedaction",{source:this,action:e})}},{key:"cachePageRef",value:function(e,t){if(t){var n=t.num+" "+t.gen+" R";this._pagesRefCache[n]=e}}},{key:"_cachedPageNumber",value:function(e){var t=e.num+" "+e.gen+" R";return this._pagesRefCache&&this._pagesRefCache[t]||null}},{key:"pagesCount",get:function(){return this.pdfDocument?this.pdfDocument.numPages:0}},{key:"page",get:function(){return this.pdfViewer.currentPageNumber},set:function(e){this.pdfViewer.currentPageNumber=e}},{key:"rotation",get:function(){return this.pdfViewer.pagesRotation},set:function(e){this.pdfViewer.pagesRotation=e}}]),e}();function isValidExplicitDestination(e){if(!Array.isArray(e))return!1;var t=e.length,n=!0;if(t<2)return!1;var i=e[0];if(!("object"===(void 0===i?"undefined":_typeof(i))&&Number.isInteger(i.num)&&Number.isInteger(i.gen)||Number.isInteger(i)&&i>=0))return!1;var a=e[1];if("object"!==(void 0===a?"undefined":_typeof(a))||"string"!=typeof a.name)return!1;switch(a.name){case"XYZ":if(5!==t)return!1;break;case"Fit":case"FitB":return 2===t;case"FitH":case"FitBH":case"FitV":case"FitBV":if(3!==t)return!1;break;case"FitR":if(6!==t)return!1;n=!1;break;default:return!1}for(var s=2;s<t;s++){var r=e[s];if(!("number"==typeof r||n&&null===r))return!1}return!0}