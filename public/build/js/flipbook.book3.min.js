var FLIPBOOK=FLIPBOOK||{};FLIPBOOK.Book3=function(t,e,i){this.options=i,this.main=e,this.singlePage=i.singlePageMode,this.pageWidth=this.options.pageWidth,this.pageHeight=this.options.pageHeight,this.wrapper=t,this.wrapper.classList.add("flipbook-book3"),this.bookLayer=this.wrapper.parentNode,this.flipEasing="easeInOutCubic",this.flipEasing="easeOutSine",this.flipEasing="easeOutQuad",this.translateZ="",this.scroll=new FLIPBOOK.IScroll(this.bookLayer,{zoom:!0,scrollX:!0,scrollY:!0,scrollbars:!0,keepInCenterV:!0,keepInCenterH:!0,freeScroll:!0,preventDefault:!1}),["toolMove","toolSelect","updateTool"].forEach((t=>e.on(t,this.updateTool.bind(this)))),this.scroll.on("zoomEnd",(()=>{if(isNaN(this.scroll.scale))return this.zoomTo(i.zoomMin);i.main.onZoom(this.scroll.scale/this.ratio),this.updateVisiblePages();let t=i.main.zoom>1;if(this.zoomed!==t){const e=this.scroll.options;e.eventPassthrough=t?"":"vertical",e.freeScroll=t,this.scroll.refresh(),this.zooed=t}})),this.wrapper.style.width=2*this.pageWidth+"px",this.wrapper.style.height=`${this.pageHeight}px`,this.centerContainer=document.createElement("div"),this.wrapper.appendChild(this.centerContainer),this.centerContainer.className="flipbook-center-container3",this.centerContainer.style.width=2*this.pageWidth+"px",this.centerContainer.style.height=`${this.pageHeight}px`;let s=2e5;this.options.perspective?s=this.options.perspective:"3d"===this.options.viewMode&&(s=3*this.pageHeight),this.centerContainer.style.perspective=`${s}px`,this.pagesArr=[],this.animating=!1;var o=this.options.pages;this.numPages=o.length;var n=o.length/2;this.options.cover||(n+=1),this.singlePage&&(n=o.length);for(var a=0;a<n;a++){var h=new FLIPBOOK.Page3(this,a);this.pagesArr.push(h),this.centerContainer.appendChild(h.wrapper)}},FLIPBOOK.Book3.prototype=Object.create(FLIPBOOK.Book.prototype),FLIPBOOK.Book3.prototype.constructor=FLIPBOOK.Book3,FLIPBOOK.Book3.prototype.enableMouseWheelZoom=function(){this.scroll.options.eventPassthrough="vertical",this.scroll.refresh()},FLIPBOOK.Book3.prototype.disableMouseWheelZoom=function(){this.scroll.options.eventPassthrough="",this.scroll.refresh()},FLIPBOOK.Book3.prototype.enablePrev=function(t){this.prevEnabled=t},FLIPBOOK.Book3.prototype.enablePan=function(){this.scroll.enable()},FLIPBOOK.Book3.prototype.disablePan=function(){this.scroll.disable()},FLIPBOOK.Book3.prototype.setRightIndex=function(t){this.rightIndex=t},FLIPBOOK.Book3.prototype.updateTool=function(){let t;switch(this.options.main.tool){case"toolSelect":this.disablePan(),t=this.wrapper.getElementsByClassName("flipbook-textLayer"),Array.from(t).forEach((t=>{t.style.pointerEvents="auto",t.classList.remove("flipbook-noselect")}));break;case"toolMove":this.enablePan(),t=this.wrapper.getElementsByClassName("flipbook-textLayer"),Array.from(t).forEach((t=>{t.style.pointerEvents="none",t.classList.add("flipbook-noselect")}))}},FLIPBOOK.Book3.prototype.enableNext=function(t){this.nextEnabled=t},FLIPBOOK.Book3.prototype.isZoomed=function(){return this.options.main.zoom>this.options.zoomMin&&this.options.main.zoom>1},FLIPBOOK.Book3.prototype.getNumPages=function(){},FLIPBOOK.Book3.prototype.move=function(t){if(!(this.zoom<=1)){var e=this.scroll;if(e){var i=e.x,s=e.y,o=20*this.zoom;switch(t){case"left":i+=o;break;case"right":i-=o;break;case"up":s+=o;break;case"down":s-=o}i>0&&(i=0),i<e.maxScrollX&&(i=e.maxScrollX-0),s>0&&(s=0),s<e.maxScrollY&&(s=e.maxScrollY-0),e.scrollTo(i,s,0)}}},FLIPBOOK.Book3.prototype.zoomTo=function(t,e,i,s){if(this.enabled){i=i||0,s=s||0,e=e||0,this.zoom=t,e=0;var o=this.scroll;o&&o.zoom(t*this.ratio,i,s,e)}},FLIPBOOK.Book3.prototype.setWrapperW=function(t){this.wrapperW!=t&&(this.wrapper.style.width=t+"px",this.wrapperW=t)},FLIPBOOK.Book3.prototype.updateBookPosition=function(){if(this.options.singlePageMode)return this.setWrapperW(this.pageWidth),this.scroll&&this.scroll.refresh(),this.view=1,void this.focusRight();1==this.view?this.setWrapperW(this.pageWidth):this.setWrapperW(2*this.pageWidth),this.scroll&&this.scroll.refresh(),2==this.view?this.isCover()?this.focusRight():this.isBackCover()&&this.options.cover?this.focusLeft():this.focusBoth():1==this.view&&(this.isCover()?this.focusRight():this.isBackCover()&&this.focusLeft())},FLIPBOOK.Book3.prototype.focusLeft=function(t,e){var i=1==this.view||this.options.singlePageMode?0:this.pageWidth/2;this.setBookPosition(i,t,e)},FLIPBOOK.Book3.prototype.focusRight=function(t,e,i){var s=1==this.view||this.options.singlePageMode?-this.pageWidth:-this.pageWidth/2;this.setBookPosition(s,t,e,i)},FLIPBOOK.Book3.prototype.focusBoth=function(t,e){var i=1==this.view?-this.pageWidth/2:0;this.setBookPosition(i,t,e)},FLIPBOOK.Book3.prototype.setBookPosition=function(t,e,i,s){if(this.centerContainerPosition!=t){var o=this.centerContainerPosition;if(e){var n=this;const a={from:o,to:t,delay:i=i||0,duration:e,step(t){n.centerContainer.style.transform="translateX("+t+"px) "+n.translateZ},complete(){n.centerContainerPosition=t,s&&(n.updateFlipped(),n.options.main.turnPageComplete())}};this.animate(a)}else this.centerContainerPosition!=t&&(this.centerContainerPosition=t,this.centerContainer.style.transform="translateX("+t+"px) "+this.translateZ,this.updateFlipped(),this.options.main.turnPageComplete())}},FLIPBOOK.Book3.prototype.updateVisiblePages=function(t){void 0===t&&(t=!0);var e=this,i=this.rightIndex;this.singlePage||(i/=2),!this.options.backCover&&this.options.rightToLeft&&i--;var s=this.pagesArr[i],o=this.pagesArr[i+1],n=this.pagesArr[i-1],a=this.pagesArr[i-2];n&&n._setAngle(180),s&&s._setAngle(0);for(var h=0;h<this.pagesArr.length;h++)this.pagesArr[h]==s||this.pagesArr[h]==n&&!this.singlePage?(this.pagesArr[h].show(),this.pagesArr[h].unpauseHtml()):(this.pagesArr[h].hide(),this.pagesArr[h].pauseHtml()),this.pagesArr[h]._setZIndex(0);this.updateBookPosition(),n&&!this.singlePage?(e.options.main.setLoadingProgress(.1),n.load("back",(function(){e.options.main.setLoadingProgress(1),n.startHTML(),s?s.load("front",(function(){e.options.main.setLoadingProgress(1),s.load("back",null,!0),o&&o.load("front",null,!0),e.options.doublePage&&2==e.view||s.startHTML()})):(n.load("front",null,!0),a&&a.load("back",null,!0))}))):(e.options.main.setLoadingProgress(.1),s.load("front",(function(){e.options.main.setLoadingProgress(1),e.singlePage?n&&n.load("front",null,!0):s.load("back",null,!0),o&&o.load("front",null,!0),s.startHTML()})))},FLIPBOOK.Book3.prototype.enable=function(){this.onResize(),this.enabled=!0},FLIPBOOK.Book3.prototype.disable=function(){this.onResize(),this.enabled=!1},FLIPBOOK.Book3.prototype.getLeftPage=function(){return this.pagesArr[this.flippedleft-1]},FLIPBOOK.Book3.prototype.getRightPage=function(){return this.pagesArr[this.flippedleft]},FLIPBOOK.Book3.prototype.getLeftBackPage=function(){return this.pagesArr[this.flippedleft-2]},FLIPBOOK.Book3.prototype.getRightBackPage=function(){return this.pagesArr[this.flippedleft+1]},FLIPBOOK.Book3.prototype.getNextPage=function(){return this.pagesArr[this.flippedleft+2]},FLIPBOOK.Book3.prototype.getPrevPage=function(){return this.pagesArr[this.flippedleft-3]},FLIPBOOK.Book3.prototype.nextPage=function(){if(this.nextEnabled)if(1!=this.view||!this.isFocusedLeft()||this.singlePage)this.goToPage(this.rightIndex+2);else{var t=700*this.options.pageFlipDuration/2;this.focusRight(t,0,!0)}},FLIPBOOK.Book3.prototype.prevPage=function(){if(this.prevEnabled)if(1!=this.view||!this.isFocusedRight()||this.singlePage){var t=this.singlePage?this.rightIndex:this.rightIndex-2;this.goToPage(t)}else{var e=700*this.options.pageFlipDuration/2;this.focusLeft(e,0,!0)}},FLIPBOOK.Book3.prototype.goToPage=function(t,e){if(this.enabled&&!this.flipping&&((this.singlePage||t%2!=0)&&t--,t<0&&(t=0),t>this.options.pages.length&&(t=this.options.pages.length),t!=this.rightIndex))if(e||this.options.instantFlip)this.setRightIndex(t),this.updateFlipped(),this.updateVisiblePages(),this.options.main.turnPageComplete();else{var i,s=this,o=700*this.options.pageFlipDuration,n=this.flipEasing;void 0===jQuery.easing[n]&&this.options.main.initEasing(),t>this.rightIndex?(i=180,(s.angle<=0||s.angle>=180||!s.angle)&&(s.angle=1)):t<this.rightIndex&&(i=-180,(s.angle>=0||s.angle<=-180||!s.angle)&&(s.angle=-1)),this.flipping=!0,this.singlePage||(1==this.view?t<this.rightIndex?this.focusRight(o):this.focusLeft(o):0==t?this.focusRight(o):t==2*this.pagesArr.length?this.focusLeft(o):this.focusBoth(o)),this.goingToPage=t,this.singlePage&&(o/=2);const e={from:s.angle,to:i,duration:o,easing:n,step(t){s._setPageAngle(t)},complete(){s.setRightIndex(s.goingToPage),s.angle=0,s.flipping=!1,s.updateFlipped(),s.updateVisiblePages(),s.options.main.turnPageComplete()}};this.animate(e),this.options.main.turnPageStart()}},FLIPBOOK.Book3.prototype.animate=function(t){jQuery({someValue:t.from}).animate({someValue:t.to},t)},FLIPBOOK.Book3.prototype.updateFlipped=function(){this.singlePage?(this.flippedleft=this.rightIndex,this.flippedright=this.options.pages.length-this.rightIndex):(this.flippedleft=(this.rightIndex+this.rightIndex%2)/2,this.flippedright=this.options.pages.length/2-this.flippedleft)},FLIPBOOK.Book3.prototype.onSwipe=function(t,e,i,s,o,n){if(this.isZoomed()||"flipbook-page-link"===t.target.className||this.flipping)return;const a=180*-i/this.main.wrapperW,h=Math.abs(i);if("start"!==e){if(("end"===e||"cancel"===e)&&n<=1&&h>5)return a>0?this.nextPage():this.prevPage(),void(this.dragging=!1);if("move"===e&&n<=1&&this.dragging&&h>5){let t=a>0?this.singlePage?1:2:this.singlePage?-1:-2;if(a>0&&!this.nextEnabled||a<0&&!this.prevEnabled)return;this.goingToPage=this.rightIndex+t,this.goingToPage!==this.rightIndex&&this.goingToPage>=0&&this.goingToPage<=2*this.pagesArr.length&&!this.options.instantFlip&&this._setPageAngle(a)}}else this.dragging=!0},FLIPBOOK.Book3.prototype.pauseHtml=function(){for(var t=0;t<this.pagesArr.length;t++)this.pagesArr[t].pauseHtml()},FLIPBOOK.Book3.prototype._setPageAngle=function(t){if(this.angle!=t){var e,i,s,o;this.angle=t,this.angle=t,this.pauseHtml();var n,a=this.rightIndex,h=this.goingToPage;if(this.options.rightToLeft&&!this.options.backCover&&(a--,h--),this.singlePage)o=this.pagesArr[a],s=this.pagesArr[a-1],t>0?(o._setAngle(t/2),(i=this.pagesArr[h])&&(i.show(),i.load("front"))):((s=this.pagesArr[h]).show(),s.load("front"),s._setAngle(t/2+90)),i&&i._setAngle(0),e&&e._setAngle(90);else{o=this.pagesArr[a/2],s=this.pagesArr[a/2-1];var r=this.pagesArr[h/2-1],p=this.pagesArr[h/2];if(t>0){if(1==this.view&&this.isFocusedLeft())return;t<90?(n=o,r.hide()):(n=r,o.hide()),n.show(),n._setAngle(t),i=this.pagesArr[h/2],n.load("back",(function(){i&&(i.show(),i.load("front",null,!0))}),!0)}else{if(1==this.view&&this.isFocusedRight())return;t>-90?(n=s,p.hide()):(n=p,s.hide()),n.show(),n._setAngle(180+t),e=this.pagesArr[h/2-1],n.load("front",(function(){e&&(e.show(),e.load("back",null,!0))}),!0)}i&&i._setAngle(0),e&&e._setAngle(180)}}},FLIPBOOK.Book3.prototype.isCover=function(){return 0==this.rightIndex},FLIPBOOK.Book3.prototype.isBackCover=function(){return this.rightIndex==this.options.pages.length},FLIPBOOK.Book3.prototype.onPageUnloaded=function(t){var e=t;this.options.rightToLeft&&(e=this.options.pages.length-t-1),this.pagesArr[e]&&this.pagesArr[e].unload()},FLIPBOOK.Book3.prototype.onResize=function(){var t=this,e=this.main,i=e.wrapperW,s=e.wrapperH,o=e.bookW,n=e.bookH,a=e.pageW,h=e.pageH,r=i/s,p=a/h,l=this.options;function g(){t.ratio=s/n,c()}function d(){t.ratio=1==t.view?i/a:i/o,c()}function c(){t.scroll&&(t.scroll.options.zoomMin=t.ratio*l.zoomMin),t.scroll&&(t.scroll.options.zoomMax=t.ratio*l.zoomMax),t.updateBookPosition(),t.scroll&&t.scroll.zoom(t.ratio*l.main.zoom,i/2,s/2,0),t.bookScale=t.scroll.scale}var f=Math.min(this.zoom,1),u=Number(this.options.zoomMin);this.singlePage||this.options.responsiveView&&i<=this.options.responsiveViewTreshold&&r<2*p&&r<this.options.responsiveViewRatio?(this.view=1,this.sc=p>r?u*r/(p*f):1,i/s>a/h?g():d()):(this.view=2,this.sc=r<2*p?u*r/(2*p*f):1,i/s>=o/n?g():d()),this.updateBookPosition(),this.updateFlipped(),this.options.main.turnPageComplete()},FLIPBOOK.Book3.prototype.isFocusedRight=function(){var t=1==this.view?-this.pageWidth/2:0;return this.singlePage?this.rightIndex%2==0:this.centerContainerPosition<t},FLIPBOOK.Book3.prototype.isFocusedLeft=function(){var t=1==this.view?-this.pageWidth/2:0;return this.singlePage?this.rightIndex%2==1:this.centerContainerPosition>t},FLIPBOOK.Page3=function(t,e){this.book=t,this.main=t.main,this.options=t.options,this.index=e,this.translateZ="",this.wrapper=document.createElement("div"),this.wrapper.className="flipbook-page3",this.wrapper.style.width=t.options.pageWidth+"px",this.wrapper.style.height=t.options.pageHeight+"px",this.angle=0;var i=t.options;let s=i.pagePreloader||i.assets.spinner,o=i.pagePreloader?"flipbook-page-preloader-image":"flipbook-page-preloader";this.front=document.createElement("div"),this.wrapper.appendChild(this.front),this.front.className="flipbook-page3-inner flipbook-page3-inner-front",this.bgFront=document.createElement("div"),this.front.appendChild(this.bgFront),this.bgFront.className="flipbook-page3-bg",this.htmlFront=document.createElement("div"),this.front.appendChild(this.htmlFront),this.htmlFront.className="flipbook-page3-html page_"+String(2*e),this.htmlFront.style.width=1e3*i.pageWidth/i.pageHeight+"px",this.htmlFront.style.transform="scale("+this.options.pageHeight/1e3+") "+this.translateZ,this.frontHtmlContentVisible=!1,this.preloaderFront=new Image,this.preloaderFront.src=s,this.preloaderFront.className=o,this.front.appendChild(this.preloaderFront),i.singlePageMode||(this.back=document.createElement("div"),this.wrapper.appendChild(this.back),this.back.className="flipbook-page3-inner flipbook-page3-inner-back",this._setVisibility(this.back,!1),this.bgBack=document.createElement("div"),this.back.appendChild(this.bgBack),this.bgBack.className="flipbook-page3-bg",this.htmlBack=document.createElement("div"),this.back.appendChild(this.htmlBack),this.htmlBack.className="flipbook-page3-html page_"+String(2*e+1),this.htmlBack.style.width=1e3*i.pageWidth/i.pageHeight+"px",this.htmlBack.style.transform="scale("+this.options.pageHeight/1e3+") "+this.translateZ,this.backHtmlContentVisible=!1,this.preloaderBack=new Image,this.preloaderBack.src=s,this.preloaderBack.className=o,this.back.appendChild(this.preloaderBack)),this.hide(),this.zIndex=0,this.options.rightToLeft&&!this.options.backCover&&e++,this.wrapper.style.left=String(this.book.options.pageWidth-1)+"px"},FLIPBOOK.Page3.prototype={load:function(t,e,i){var s=this.book.pageHeight*this.book.scroll.scale*window.devicePixelRatio,o=this.options,n=s<o.pageTextureSizeSmall?o.pageTextureSizeSmall:o.pageTextureSize,a="front"==t||o.singlePageMode;if(this.sizeFront==n&&a||this.sizeBack==n&&!a)i||this.loadHTML(a),e&&e.call(this);else{a?this.sizeFront=n:this.sizeBack=n;var h=this,r=o.singlePageMode?this.index:a?2*this.index:2*this.index+1,p=o.rightToLeft?o.pages.length-r-1:r;o.main.loadPage(p,n,(function(t){if(t&&t.image){var s=t.image[n]||t.image;a&&"right"==h.options.pages[p].side&&(s.clone||(s.clone=new Image,s.clone.src=s.src),(s=s.clone).style.transform="translateX(-50%) "+h.translateZ),a?(h.bgFront.replaceChildren(s),h.preloaderFront.style.display="none"):(h.bgBack.replaceChildren(s),h.preloaderBack.style.display="none"),i||h.loadHTML(a)}e&&e.call(h)}))}},loadHTML:function(t){var e=this,i=this.options.singlePageMode?this.index:t?2*this.index:2*this.index+1,s=e.options.rightToLeft?this.book.pagesArr.length-i-1:i;s<0||(t&&this.htmlContentFront||!t&&this.htmlContentBack?this.updateHtmlContent(t):this.options.main.loadPageHTML(s,(function(i){t?e.htmlContentFront=i:e.htmlContentBack=i,e.updateHtmlContent(t)})))},startHTML:function(){this.wrapper.querySelectorAll(".flipbook-page-item").forEach((function(t){if("VIDEO"==t.nodeName||"AUDIO"==t.nodeName){const e=t.getAttribute("data-url");t.querySelector("source").setAttribute("src",e),t.load(),t.style.visibility="hidden",t.autoplay&&(t.readyState<4?t.oncanplay=function(){this.currentTime==this.duration&&this.load(),this.play(),t.style.visibility="visible"}:(t.currentTime==t.duration&&t.load(),t.play(),t.style.visibility="visible"))}}))},unload:function(){this.size=null,this.mat=!1,this.pageSize=null},pauseHtml:function(){if(!this.htmlPaused){this.htmlPaused=!0,this.main.trigger("hidepagehtml",{page:this});var t=this.wrapper.querySelector("video, audio");t&&t.pause();for(var e=this.wrapper.getElementsByClassName("flipbook-page-item-youtube"),i=0;i<e.length;i++){e[i].contentWindow.postMessage('{"event":"command","func":"pauseVideo","args":""}',"*")}}},unpauseHtml:function(){this.htmlPaused=!1},showHtml:function(){this.htmlContentVisible||(this.htmlContentVisible=!0)},updateHtmlContent:function(t){var e=t?this.htmlContentFront:this.htmlContentBack;e.jquery&&(e=e[0]),t?e&&!this.htmlLoadedFront&&(this.htmlLoadedFront=!0,this.htmlFront.appendChild(e),this.main.trigger("updateTool"),this.main.trigger("showpagehtml",{page:this})):e&&!this.htmlLoadedBack&&(this.htmlLoadedBack=!0,this.htmlBack.appendChild(e),this.main.trigger("updateTool"),this.main.trigger("showpagehtml",{page:this}))},show:function(){this.hidden&&(this.wrapper.style.display="block",this.setShadowOpacity(0),this.showHtml()),this.hidden=!1},setShadowOpacity:function(t){this.shadowOpacity==t||this.hidden||(this.wrapper.style.setProperty("--page3-shadow-opacity",t),this.shadowOpacity=t)},hide:function(){this.hidden||(this.wrapper.style.display="none",this.setShadowOpacity(0)),this.hidden=!0},_setVisibility:function(t,e){t&&t.dataset.visible!=e&&(t.dataset.visible=e,t.style.opacity=e?"1":"0",t.style.pointerEvents=e?"auto":"none")},_setAngle:function(t){if((t=-t)!=this.angle){var e;this.setShadowOpacity(.2*(1-Math.abs(t+90)/90)),this.wrapper.style.setProperty("--page3-rotate-y",String(t+"deg")),this._setVisibility(this.front,t>-90),this._setVisibility(this.back,t<-90),this.angle=t;var i=0;for(e=0;e<this.book.pagesArr.length;e++)e!=this.index&&this.book.pagesArr[e].zIndex>i&&(i=this.book.pagesArr[e].zIndex);this._setZIndex(i+1)}},_setZIndex:function(t){this.zIndex!=t&&(this.wrapper.style["z-index"]=t),this.zIndex=t}};